{"ast":null,"code":"import _regeneratorRuntime from\"/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import NavHeader from'./components/NavHeader/NavHeader';import ImgContainer from'./components/ImgContainer/ImgContainer';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.getSrc=function(id,type){return _this.state.photos[id].src[type];};_this.getPhotographer=function(id){return _this.state.photos[id].photographer;};_this.getJson=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(category,url){var res,json,message;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;url=url==''?\"https://api.pexels.com/v1/search?query=\".concat(category,\"&per_page=\").concat(_this.pexelsPerPage):url;_context.next=4;return fetch(url,{headers:{Authorization:process.env.REACT_APP_PEXELS_API_KEY}});case 4:res=_context.sent;_context.next=7;return res.json();case 7:json=_context.sent;if(res.ok){_context.next=10;break;}throw{status:res.status,statusText:res.statusText};case 10:return _context.abrupt(\"return\",json);case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);message=_context.t0.statusText||\"Ocurrió un error\";console.log(\"Error \".concat(_context.t0.status,\": \").concat(message));return _context.abrupt(\"return\",{});case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this.getPhotos=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(category,cantidad){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(_this.state.categories[category].availableIds.length<cantidad)){_context2.next=8;break;}_context2.t0=_this;_context2.t1=category;_context2.next=5;return _this.getJson(category,_this.getNextPage(category));case 5:_context2.t2=_context2.sent;_context2.next=8;return _context2.t0.push.call(_context2.t0,_context2.t1,_context2.t2);case 8:return _context2.abrupt(\"return\",_this.getRandom(category,cantidad));case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3,_x4){return _ref2.apply(this,arguments);};}();_this.addToImgContainer=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(category,num_img){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this.setState({activeCategory:category});_context3.next=3;return _this.getPhotos(category,num_img);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x5,_x6){return _ref3.apply(this,arguments);};}();_this.infiniteScroll=function(){if(window.scrollY+window.innerHeight>=document.documentElement.scrollHeight)_this.addToImgContainer(_this.state.activeCategory,_this.defaultNumImg);};_this.pexelsPerPage=100;_this.defaultNumImg=10;_this.categoriesList=['landscape','city','nature','forest','sailboat','sea','beach','mountain'];_this.state={activeCategory:'landscape',categories:{},usedIds:[],photos:{}};_this.categoriesList.forEach(function(category){return _this.state.categories[category]={page:0,next_page:'',availableIds:[]};});return _this;}_createClass(App,[{key:\"isIndUsedIds\",value:function isIndUsedIds(id){return this.state.usedIds.includes(id);}},{key:\"isInCategories\",value:function isInCategories(id){return Object.values(this.state.categories).some(function(category){return category.availableIds.includes(id);});}},{key:\"push\",value:function push(category,json){var _this2=this;this.state.categories[category].next_page=json.next_page;this.state.categories[category].page=json.page;json.photos.forEach(function(photo){if(_this2.isIndUsedIds(photo.id)===false&&_this2.isInCategories(photo.id)===false){_this2.state.categories[category].availableIds.push(photo.id);_this2.state.photos[photo.id]=photo;}});}},{key:\"getRandom\",value:function getRandom(category,cantidad){var _this3=this;var disponibles=function disponibles(){return _this3.state.categories[category].availableIds.length;};var random=[];var ciclos=cantidad<disponibles()?cantidad:disponibles();while(random.length<ciclos){var index=Math.floor(Math.random()*(disponibles()-1));if(!random.includes(this.state.categories[category].availableIds[index])){var id=this.state.categories[category].availableIds.splice(index,1).pop();random.push(id);this.state.usedIds.push(id);}this.setState({usedIds:this.state.usedIds});}this.state.usedIds.push();return random;}},{key:\"getNextPage\",value:function getNextPage(category){return this.state.categories[category].next_page;}},{key:\"componentDidMount\",value:function componentDidMount(){this.addToImgContainer(this.state.activeCategory,12);window.addEventListener('scroll',this.infiniteScroll,true);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.removeEventListener('scroll',this.infiniteScroll);}},{key:\"render\",value:function render(){console.log(this.state);console.log(this.state.usedIds);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(NavHeader,{activeCategory:this.state.activeCategory,categoriesList:this.categoriesList,categoriesCallback:this.addToImgContainer}),/*#__PURE__*/_jsx(ImgContainer,{usedIds:this.state.usedIds,getSrc:this.getSrc,getPhotographer:this.getPhotographer})]});}}]);return App;}(React.Component);export default App;","map":{"version":3,"names":["React","NavHeader","ImgContainer","App","props","getSrc","id","type","state","photos","src","getPhotographer","photographer","getJson","category","url","pexelsPerPage","fetch","headers","Authorization","process","env","REACT_APP_PEXELS_API_KEY","res","json","ok","status","statusText","message","console","log","getPhotos","cantidad","categories","availableIds","length","getNextPage","push","getRandom","addToImgContainer","num_img","setState","activeCategory","infiniteScroll","window","scrollY","innerHeight","document","documentElement","scrollHeight","defaultNumImg","categoriesList","usedIds","forEach","page","next_page","includes","Object","values","some","photo","isIndUsedIds","isInCategories","disponibles","random","ciclos","index","Math","floor","splice","pop","addEventListener","removeEventListener","Component"],"sources":["/hdd1/Alejandro_02/cursos/UTNBA-FullStackDev/proyecto-final-front/linea_03/r-image/src/App.js"],"sourcesContent":["import React from 'react';\nimport NavHeader from './components/NavHeader/NavHeader';\nimport ImgContainer from './components/ImgContainer/ImgContainer';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.pexelsPerPage = 100;\n    this.defaultNumImg = 10;\n    this.categoriesList = ['landscape', 'city', 'nature', 'forest', 'sailboat', 'sea', 'beach', 'mountain'];\n    this.state = { activeCategory: 'landscape', categories: {}, usedIds: [], photos: {} };\n    this.categoriesList.forEach(category => this.state.categories[category] = { page: 0, next_page: '', availableIds: [] });\n  }\n\n  isIndUsedIds(id) {\n    return this.state.usedIds.includes(id);\n  }\n\n  isInCategories(id) {\n    return Object.values(this.state.categories).some((category) => (category.availableIds.includes(id)));\n  }\n\n  push(category, json) {\n    this.state.categories[category].next_page = json.next_page;\n    this.state.categories[category].page = json.page;\n    json.photos.forEach(photo => {\n      if (this.isIndUsedIds(photo.id) === false && this.isInCategories(photo.id) === false) {\n        this.state.categories[category].availableIds.push(photo.id);\n        this.state.photos[photo.id] = photo;\n      }\n    })\n  }\n\n  getRandom(category, cantidad) {\n    const disponibles = () => this.state.categories[category].availableIds.length;\n    let random = [];\n    let ciclos = cantidad < disponibles() ? cantidad : disponibles();\n    while (random.length < ciclos) {\n      let index = Math.floor(Math.random() * (disponibles() - 1));\n      if (!random.includes(this.state.categories[category].availableIds[index])) {\n        let id = this.state.categories[category].availableIds.splice(index, 1).pop();\n        random.push(id);\n        this.state.usedIds.push(id);\n      }\n      this.setState({ usedIds: this.state.usedIds });\n    }\n    this.state.usedIds.push()\n    return random;\n  }\n\n  getSrc = (id, type) => {\n    return this.state.photos[id].src[type];\n  }\n\n  getPhotographer = (id) => {\n    return this.state.photos[id].photographer;\n  }\n\n  getNextPage(category) {\n    return this.state.categories[category].next_page;\n  }\n\n  getJson = async (category, url) => {\n    try {\n      url = (url == '') ? `https://api.pexels.com/v1/search?query=${category}&per_page=${this.pexelsPerPage}` : url;\n      let res = await fetch(url, { headers: { Authorization: process.env.REACT_APP_PEXELS_API_KEY } });\n      let json = await res.json();\n\n      if (!res.ok) throw { status: res.status, statusText: res.statusText };\n\n      return json;\n\n    } catch (err) {\n      let message = err.statusText || \"Ocurrió un error\";\n      console.log(`Error ${err.status}: ${message}`);\n      return {};\n    }\n  }\n\n  getPhotos = async (category, cantidad) => {\n    if (this.state.categories[category].availableIds.length < cantidad) await this.push(category, await this.getJson(category, this.getNextPage(category)));\n    return this.getRandom(category, cantidad);\n  }\n\n  addToImgContainer = async (category, num_img) => {\n    this.setState({ activeCategory: category });\n    await this.getPhotos(category, num_img);\n  }\n\n  infiniteScroll = () => {\n    if (window.scrollY + window.innerHeight >= document.documentElement.scrollHeight) this.addToImgContainer(this.state.activeCategory, this.defaultNumImg);\n  }\n\n  componentDidMount() {\n    this.addToImgContainer(this.state.activeCategory, 12);\n    window.addEventListener('scroll', this.infiniteScroll, true);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.infiniteScroll);\n  }\n\n  render() {\n    console.log(this.state);\n    console.log(this.state.usedIds);\n    return (\n      <div>\n        <NavHeader activeCategory={this.state.activeCategory} categoriesList={this.categoriesList} categoriesCallback={this.addToImgContainer} />\n        <ImgContainer usedIds={this.state.usedIds} getSrc={this.getSrc} getPhotographer={this.getPhotographer}/>\n      </div>\n    );\n  }\n\n}\n\nexport default App;"],"mappings":"g/BAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,MAAOC,UAAS,KAAM,kCAAkC,CACxD,MAAOC,aAAY,KAAM,wCAAwC,CAAC,2FAE5DC,IAAG,sGACP,aAAYC,KAAK,CAAE,qCACjB,uBAAMA,KAAK,EAAE,MA4CfC,MAAM,CAAG,SAACC,EAAE,CAAEC,IAAI,CAAK,CACrB,MAAO,OAAKC,KAAK,CAACC,MAAM,CAACH,EAAE,CAAC,CAACI,GAAG,CAACH,IAAI,CAAC,CACxC,CAAC,OAEDI,eAAe,CAAG,SAACL,EAAE,CAAK,CACxB,MAAO,OAAKE,KAAK,CAACC,MAAM,CAACH,EAAE,CAAC,CAACM,YAAY,CAC3C,CAAC,OAMDC,OAAO,4FAAG,iBAAOC,QAAQ,CAAEC,GAAG,yJAE1BA,GAAG,CAAIA,GAAG,EAAI,EAAE,kDAA8CD,QAAQ,sBAAa,MAAKE,aAAa,EAAKD,GAAG,CAAC,sBAC9FE,MAAK,CAACF,GAAG,CAAE,CAAEG,OAAO,CAAE,CAAEC,aAAa,CAAEC,OAAO,CAACC,GAAG,CAACC,wBAAyB,CAAE,CAAC,CAAC,QAA5FC,GAAG,qCACUA,IAAG,CAACC,IAAI,EAAE,QAAvBA,IAAI,kBAEHD,GAAG,CAACE,EAAE,+BAAQ,CAAEC,MAAM,CAAEH,GAAG,CAACG,MAAM,CAAEC,UAAU,CAAEJ,GAAG,CAACI,UAAW,CAAC,yCAE9DH,IAAI,4DAGPI,OAAO,CAAG,YAAID,UAAU,EAAI,kBAAkB,CAClDE,OAAO,CAACC,GAAG,iBAAU,YAAIJ,MAAM,cAAKE,OAAO,EAAG,CAAC,gCACxC,CAAC,CAAC,uEAEZ,yEAEDG,SAAS,6FAAG,kBAAOjB,QAAQ,CAAEkB,QAAQ,6HAC/B,MAAKxB,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACoB,YAAY,CAACC,MAAM,CAAGH,QAAQ,2DAAkBlB,QAAQ,wBAAQ,OAAKD,OAAO,CAACC,QAAQ,CAAE,MAAKsB,WAAW,CAACtB,QAAQ,CAAC,CAAC,yEAAvEuB,IAAI,sFAC5E,MAAKC,SAAS,CAACxB,QAAQ,CAAEkB,QAAQ,CAAC,0DAC1C,2EAEDO,iBAAiB,6FAAG,kBAAOzB,QAAQ,CAAE0B,OAAO,wHAC1C,MAAKC,QAAQ,CAAC,CAAEC,cAAc,CAAE5B,QAAS,CAAC,CAAC,CAAC,uBACtC,OAAKiB,SAAS,CAACjB,QAAQ,CAAE0B,OAAO,CAAC,yDACxC,2EAEDG,cAAc,CAAG,UAAM,CACrB,GAAIC,MAAM,CAACC,OAAO,CAAGD,MAAM,CAACE,WAAW,EAAIC,QAAQ,CAACC,eAAe,CAACC,YAAY,CAAE,MAAKV,iBAAiB,CAAC,MAAK/B,KAAK,CAACkC,cAAc,CAAE,MAAKQ,aAAa,CAAC,CACzJ,CAAC,CApFC,MAAKlC,aAAa,CAAG,GAAG,CACxB,MAAKkC,aAAa,CAAG,EAAE,CACvB,MAAKC,cAAc,CAAG,CAAC,WAAW,CAAE,MAAM,CAAE,QAAQ,CAAE,QAAQ,CAAE,UAAU,CAAE,KAAK,CAAE,OAAO,CAAE,UAAU,CAAC,CACvG,MAAK3C,KAAK,CAAG,CAAEkC,cAAc,CAAE,WAAW,CAAET,UAAU,CAAE,CAAC,CAAC,CAAEmB,OAAO,CAAE,EAAE,CAAE3C,MAAM,CAAE,CAAC,CAAE,CAAC,CACrF,MAAK0C,cAAc,CAACE,OAAO,CAAC,SAAAvC,QAAQ,QAAI,OAAKN,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAAG,CAAEwC,IAAI,CAAE,CAAC,CAAEC,SAAS,CAAE,EAAE,CAAErB,YAAY,CAAE,EAAG,CAAC,GAAC,CAAC,aAC1H,CAAC,4CAED,sBAAa5B,EAAE,CAAE,CACf,MAAO,KAAI,CAACE,KAAK,CAAC4C,OAAO,CAACI,QAAQ,CAAClD,EAAE,CAAC,CACxC,CAAC,8BAED,wBAAeA,EAAE,CAAE,CACjB,MAAOmD,OAAM,CAACC,MAAM,CAAC,IAAI,CAAClD,KAAK,CAACyB,UAAU,CAAC,CAAC0B,IAAI,CAAC,SAAC7C,QAAQ,QAAMA,SAAQ,CAACoB,YAAY,CAACsB,QAAQ,CAAClD,EAAE,CAAC,EAAC,CAAC,CACtG,CAAC,oBAED,cAAKQ,QAAQ,CAAEU,IAAI,CAAE,iBACnB,IAAI,CAAChB,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACyC,SAAS,CAAG/B,IAAI,CAAC+B,SAAS,CAC1D,IAAI,CAAC/C,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACwC,IAAI,CAAG9B,IAAI,CAAC8B,IAAI,CAChD9B,IAAI,CAACf,MAAM,CAAC4C,OAAO,CAAC,SAAAO,KAAK,CAAI,CAC3B,GAAI,MAAI,CAACC,YAAY,CAACD,KAAK,CAACtD,EAAE,CAAC,GAAK,KAAK,EAAI,MAAI,CAACwD,cAAc,CAACF,KAAK,CAACtD,EAAE,CAAC,GAAK,KAAK,CAAE,CACpF,MAAI,CAACE,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACoB,YAAY,CAACG,IAAI,CAACuB,KAAK,CAACtD,EAAE,CAAC,CAC3D,MAAI,CAACE,KAAK,CAACC,MAAM,CAACmD,KAAK,CAACtD,EAAE,CAAC,CAAGsD,KAAK,CACrC,CACF,CAAC,CAAC,CACJ,CAAC,yBAED,mBAAU9C,QAAQ,CAAEkB,QAAQ,CAAE,iBAC5B,GAAM+B,YAAW,CAAG,QAAdA,YAAW,SAAS,OAAI,CAACvD,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACoB,YAAY,CAACC,MAAM,GAC7E,GAAI6B,OAAM,CAAG,EAAE,CACf,GAAIC,OAAM,CAAGjC,QAAQ,CAAG+B,WAAW,EAAE,CAAG/B,QAAQ,CAAG+B,WAAW,EAAE,CAChE,MAAOC,MAAM,CAAC7B,MAAM,CAAG8B,MAAM,CAAE,CAC7B,GAAIC,MAAK,CAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACH,MAAM,EAAE,EAAID,WAAW,EAAE,CAAG,CAAC,CAAC,CAAC,CAC3D,GAAI,CAACC,MAAM,CAACR,QAAQ,CAAC,IAAI,CAAChD,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACoB,YAAY,CAACgC,KAAK,CAAC,CAAC,CAAE,CACzE,GAAI5D,GAAE,CAAG,IAAI,CAACE,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACoB,YAAY,CAACmC,MAAM,CAACH,KAAK,CAAE,CAAC,CAAC,CAACI,GAAG,EAAE,CAC5EN,MAAM,CAAC3B,IAAI,CAAC/B,EAAE,CAAC,CACf,IAAI,CAACE,KAAK,CAAC4C,OAAO,CAACf,IAAI,CAAC/B,EAAE,CAAC,CAC7B,CACA,IAAI,CAACmC,QAAQ,CAAC,CAAEW,OAAO,CAAE,IAAI,CAAC5C,KAAK,CAAC4C,OAAQ,CAAC,CAAC,CAChD,CACA,IAAI,CAAC5C,KAAK,CAAC4C,OAAO,CAACf,IAAI,EAAE,CACzB,MAAO2B,OAAM,CACf,CAAC,2BAUD,qBAAYlD,QAAQ,CAAE,CACpB,MAAO,KAAI,CAACN,KAAK,CAACyB,UAAU,CAACnB,QAAQ,CAAC,CAACyC,SAAS,CAClD,CAAC,iCAiCD,4BAAoB,CAClB,IAAI,CAAChB,iBAAiB,CAAC,IAAI,CAAC/B,KAAK,CAACkC,cAAc,CAAE,EAAE,CAAC,CACrDE,MAAM,CAAC2B,gBAAgB,CAAC,QAAQ,CAAE,IAAI,CAAC5B,cAAc,CAAE,IAAI,CAAC,CAC9D,CAAC,oCAED,+BAAuB,CACrBC,MAAM,CAAC4B,mBAAmB,CAAC,QAAQ,CAAE,IAAI,CAAC7B,cAAc,CAAC,CAC3D,CAAC,sBAED,iBAAS,CACPd,OAAO,CAACC,GAAG,CAAC,IAAI,CAACtB,KAAK,CAAC,CACvBqB,OAAO,CAACC,GAAG,CAAC,IAAI,CAACtB,KAAK,CAAC4C,OAAO,CAAC,CAC/B,mBACE,oCACE,KAAC,SAAS,EAAC,cAAc,CAAE,IAAI,CAAC5C,KAAK,CAACkC,cAAe,CAAC,cAAc,CAAE,IAAI,CAACS,cAAe,CAAC,kBAAkB,CAAE,IAAI,CAACZ,iBAAkB,EAAG,cACzI,KAAC,YAAY,EAAC,OAAO,CAAE,IAAI,CAAC/B,KAAK,CAAC4C,OAAQ,CAAC,MAAM,CAAE,IAAI,CAAC/C,MAAO,CAAC,eAAe,CAAE,IAAI,CAACM,eAAgB,EAAE,GACpG,CAEV,CAAC,iBA3GeX,KAAK,CAACyE,SAAS,EA+GjC,cAAetE,IAAG"},"metadata":{},"sourceType":"module"}